#!/usr/bin/env node

const {
  updatePerFileCoverageExceptions,
  runPerFileCoverageTest,
} = require("../src");

switch (process.argv[2]) {
  case "--help":
  case "-h":
    // eslint-disable-next-line no-console
    console.log(`
Usage: jest-a-coverage-slip-detector [options]

Options:
  --help, -h             Show this help

  --update               Update exceptions with improved coverage levels.
                         Used to 'ratchet' up coverage after improving it.

  --force-update         Record current coverage errors as exceptions.
                         Used to:
                           - Snapshot current coverage errors as legacy exceptions.
                           - Force accept a future reduction in coverage.
    `);
    break;
  case "--force":
  case "--force-update":
    updatePerFileCoverageExceptions(true);
    break;
  case "--update":
    updatePerFileCoverageExceptions(false);
    break;
  default:
    if (runPerFileCoverageTest()) {
      process.exit(1);
    }
    break;
}
